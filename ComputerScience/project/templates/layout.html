<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{% endblock %} • Stock Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/styles.css">
  </head>
  <body>

    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <a class="navbar-brand" href="/">Stocks</a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navMain" aria-controls="navMain" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMain">
        {% if session.user_id %}
          <ul class="navbar-nav mr-auto">
            <li class="nav-item"><a class="nav-link" href="/positions">Positions</a></li>
            <li class="nav-item"><a class="nav-link" href="/closed">Closed</a></li>
            <li class="nav-item"><a class="nav-link" href="/watchlist">Watchlist</a></li>
            <li class="nav-item"><a class="nav-link" href="/trade">Trade</a></li>
            <li class="nav-item"><a class="nav-link" href="/">Dashboard</a></li>
          </ul>

          <!-- Quick symbol jump -->
          <form class="form-inline my-2 my-lg-0" onsubmit="event.preventDefault(); if (this.symbol.value) { location.href = '/symbol/' + this.symbol.value.toUpperCase(); }">
            <input class="form-control mr-sm-2" name="symbol" list="nav-tickers" placeholder="Go to symbol… (e.g., AAPL)" aria-label="Go to symbol">
            <button class="btn btn-outline-light my-2 my-sm-0">Go</button>
          </form>
          <datalist id="nav-tickers"></datalist>

          <a class="btn btn-sm btn-outline-light ml-3" href="/logout">Logout</a>
        {% else %}
          <ul class="navbar-nav mr-auto"></ul>
          <a class="btn btn-sm btn-outline-light mr-2" href="/login">Login</a>
          <a class="btn btn-sm btn-primary" href="/register">Register</a>
        {% endif %}
      </div>
    </nav>

    <main class="container py-4">
      {% block main %}{% endblock %}
    </main>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXd2htPH0lsSSsC5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12hV3G9fGk6tQ5Z7i3GQZ9GmZ4x4nXKp4YfRvH+8abtTE1Pi" crossorigin="anonymous"></script>

    <script>
    (async () => {
      const dl = document.getElementById('nav-tickers');
      if (!dl) return;
      try {
        const r = await fetch('/static/companies.json');
        if (!r.ok) return;
        const list = await r.json();
        list.slice(0, 3000).forEach(x => {
          const o = document.createElement('option');
          o.value = x.symbol;
          o.label = x.name || x.symbol;
          dl.appendChild(o);
        });
      } catch {}
    })();
    </script>
  </body>
</html>
